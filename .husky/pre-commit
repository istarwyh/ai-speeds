#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run pre-commit hooks
echo "🔍 Running pre-commit checks..."

# Check for large files
echo "📏 Checking file sizes..."
find . -type f -not -path "./node_modules/*" -not -path "./.git/*" -not -path "./.wrangler/*" -exec sh -c 'size=$(stat -f%z "$1" 2>/dev/null || stat -c%s "$1"); if [ $size -gt 500000 ]; then echo "❌ File $1 is too large ($size bytes > 500KB)"; exit 1; fi' _ {} \;

# Run lint-staged for incremental checks
echo "🧹 Running lint-staged..."
npx lint-staged

# Type checking
echo "🔍 Running TypeScript checks..."
npm run typecheck

# Security audit
echo "🔒 Running security audit..."
npm run audit

# Build check
echo "🏗️  Testing build..."
npm run build:client

echo "✅ Pre-commit checks passed!"
